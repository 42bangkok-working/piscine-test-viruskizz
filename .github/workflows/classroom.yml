name: Autograding

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  autograde:
    runs-on: ubuntu-latest

    steps:
      # 1. Checkout student repo
      - name: Checkout student submission
        uses: actions/checkout@v3

      # 2. Setup Node.js
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 18

      # 4. Checkout private tester repo
      - name: Checkout test suite
        uses: actions/checkout@v3
        with:
          repository: 42bangkok-working/javascript-piscine-tester   # change to your org/repo
          path: tester
          token: ${{ secrets.CLASSROOM_TESTS_TOKEN }}

      - name: setup files
        run: |
          echo "Files in tester repo"
          tree .
          mkdir -p .github/classrooms
          cp tester/.github/classrooms/autograding.json .github/classrooms/
          cp tester/package.json .
          cp __tests__/* __tests__/
          tree .

      # 3. Install dependencies
      - name: Install dependencies
        run: npm install

      - name: Run Jest tests
        run: npx jest

      # 6. Autograding action
      - name: Autograding
        uses: education/autograding@v1
